<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="favicon.ico">
  <title>Nexus-JP ç¨¼åƒçŠ¶æ³</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .ok { color: green; }
    .ng { color: red; }
    .pending { color: gray; }
  </style>
</head>
<body>
  <h1>ğŸ“Š Nexus-JP ç¨¼åƒçŠ¶æ³</h1>

  <h2>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰</h2>
  <ul id="frontend-checks"></ul>

  <h2>APIï¼ˆæ“¬ä¼¼ï¼‰</h2>
  <ul>
    <li>/api/status: <span id="api-status" class="pending">ãƒã‚§ãƒƒã‚¯ä¸­...</span></li>
    <li>/api/version: <span id="api-version" class="pending">ãƒã‚§ãƒƒã‚¯ä¸­...</span></li>
  </ul>

  <h2>ç”»åƒ</h2>
  <ul>
    <li>test.png: <span id="img-test" class="pending">ãƒã‚§ãƒƒã‚¯ä¸­...</span></li>
    <li>favicon.ico: <span id="img-favicon" class="pending">ãƒã‚§ãƒƒã‚¯ä¸­...</span></li>
  </ul>

  <p>ğŸ•’ æœ€çµ‚æ›´æ–°: <span id="lastUpdated">---</span></p>

  <script>
    const frontendPages = [
      'index.html', 'about.html', 'campaign.html',
      'contact.html', 'login.html', 'signup.html',
      'mypage.html', 'status.html', '404.html'
    ];

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then(() => console.log('Service Workerç™»éŒ²æˆåŠŸ'))
        .catch(console.error);
    }

    function createListItems() {
      const list = document.getElementById('frontend-checks');
      frontendPages.forEach(page => {
        const li = document.createElement('li');
        li.innerHTML = `${page}: <span id="fe-${page}" class="pending">ãƒã‚§ãƒƒã‚¯ä¸­...</span>`;
        list.appendChild(li);
      });
    }

    async function checkEndpoint(id, url, expectJson = false) {
      const el = document.getElementById(id);
      try {
        const res = await fetch(url, { cache: 'no-store' });
        if (res.ok) {
          if (expectJson) await res.json();
          el.textContent = `OK (${res.status})`;
          el.className = 'ok';
        } else {
          el.textContent = `NG (${res.status})`;
          el.className = 'ng';
        }
      } catch {
        el.textContent = 'NG (æ¥ç¶šã‚¨ãƒ©ãƒ¼)';
        el.className = 'ng';
      }
    }

    async function checkAll() {
      document.getElementById('lastUpdated').textContent = new Date().toLocaleString();

      // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
      for (const page of frontendPages) {
        await checkEndpoint(`fe-${page}`, `/${page}`);
      }

      // æ“¬ä¼¼API
      await checkEndpoint('api-status', '/api/status', true);
      await checkEndpoint('api-version', '/api/version', true);

      // ç”»åƒ
      await checkEndpoint('img-test', '/test.png');
      await checkEndpoint('img-favicon', '/favicon.ico');
    }

    createListItems();
    checkAll();
    setInterval(checkAll, 60000);
  </script>
</body>
</html>
