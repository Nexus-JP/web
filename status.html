<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Nexus-JP ç¨¼åƒçŠ¶æ³</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  .ok { color: green; }
  .ng { color: red; }
  .pending { color: gray; }
</style>
</head>
<body>
  <h1>ğŸ“Š Nexus-JP ç¨¼åƒçŠ¶æ³</h1>
  <ul>
    <li>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: <span id="frontend" class="pending">ãƒã‚§ãƒƒã‚¯ä¸­...</span></li>
    <li>API (/api/status): <span id="api" class="pending">ãƒã‚§ãƒƒã‚¯ä¸­...</span></li>
  </ul>
  <p>æœ€çµ‚æ›´æ–°: <span id="lastUpdated">---</span></p>

  <script>
    // Service Workerç™»éŒ²ï¼ˆè¤‡æ•°ãƒšãƒ¼ã‚¸ã§å…±é€šãªã‚‰å„HTMLã«å…¥ã‚Œã¦OKï¼‰
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then(() => console.log('Service Workerç™»éŒ²æˆåŠŸ'))
        .catch(console.error);
    }

    async function checkEndpoint(id, url) {
      const el = document.getElementById(id);
      try {
        const res = await fetch(url, { cache: 'no-store' });
        if (res.ok) {
          el.textContent = `OK (${res.status})`;
          el.className = 'ok';
        } else {
          el.textContent = `NG (${res.status})`;
          el.className = 'ng';
        }
      } catch {
        el.textContent = 'NG (æ¥ç¶šã‚¨ãƒ©ãƒ¼)';
        el.className = 'ng';
      }
    }

    async function checkAll() {
      document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
      await checkEndpoint('frontend', 'https://nexus-jp.f5.si/');
      await checkEndpoint('api', '/api/status'); // Service WorkerãŒæ“¬ä¼¼å¿œç­”
    }

    checkAll();
    setInterval(checkAll, 60000);
  </script>
</body>
</html>
